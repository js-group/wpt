<!DOCTYPE html>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/mediacapture-image/resources/imagecapture-helpers.js"></script>
<body>
<script>

image_capture_test(async t => {
  let iframe = document.createElement('iframe');
  let html = "<canvas id='canvas' width=10 height=10 />";
  iframe.src = 'data:text/html;charset=utf-8,' + encodeURI(html);
  iframe.onload = t.step_func_done(() => {
    // This detaches the frame while retaining a reference to an
    // HTMLCanvasElement from it.
    let canvas = iframe.contentWindow.document.getElementById('canvas');
    document.body.removeChild(iframe);

    // Creation of the ImageCapture object (as part of the MediaStreamTrack)
    // should be safe even if the frame is detached.
    canvas.captureStream();
  });

  document.body.appendChild(iframe);
}, 'MediaStreamTrack can be obtained from a detached frame');

</script>
</body>
